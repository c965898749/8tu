"use strict";$(function(){function e(e,o){o?$(".user-warning-msg").removeClass("alert-warning").addClass("alert-success"):$(".user-warning-msg").removeClass("alert-success").addClass("alert-warning"),$(".user-warning-msg").text(e)}var o=localStorage.getItem("AP:user:token");!function(){var r=window.location.origin+"/api?datatype=api&m=console&c=UserLogin&a=isLogin";$.ajax({method:"POST",timeout:4e3,async:!1,url:r,data:{token:o},beforeSend:function(){NProgress.start()},success:function(e){e.errcode?o="":e.user.token?(o=e.user.token,localStorage.setItem("AP:user:token",e.user.token)):o=""},error:function(){e("请求超时，请检查您的网络",!1)},complete:function(){NProgress.done()}})}(),$(".btn-buy-apipost").click(function(){o?console.log("购买"):($("#userRegisterModal").modal("hide"),$("#userLoginModal").modal("show"))}),$(".user-login-show-btn").click(function(){$("#userRegisterModal").modal("hide")}),$(".user-register-show-btn").click(function(){$("#userLoginModal").modal("hide")}),$(".user-login-btn").click(function(){var r=this,n=$.trim($('form[name="userLoginForm"] input[name="email"]').val()),s=$.trim($('form[name="userLoginForm"] input[name="password"]').val()),a=$('form[name="userLoginForm"] input[name="autologin"]').prop("checked");if(!n)return e("请输入您的登录账号"),$('form[name="userLoginForm"] input[name="email"]').focus(),!1;if(s.length<6)return e("登录密码不正确"),$('form[name="userLoginForm"] input[name="password"]').val("").focus(),!1;var i=window.location.origin+"/api?datatype=api&m=console&c=UserLogin&a=login";$.ajax({method:"POST",timeout:4e3,url:i,data:{email:n,password:s},beforeSend:function(){NProgress.start(),$(".user-login-btn,.user-login-email,.user-login-password").prop("disabled",!0).addClass("disabled")},success:function(n){if(n.errcode)return e(n.errstr,!1,n.errcode),r;e("登录成功...",!0),localStorage.clear(),a&&(o=n.user.token,localStorage.setItem("AP:user:token",n.user.token)),setTimeout(function(){window.location.replace(window.location.href)},1200)},error:function(){e("用户登录失败，请检查您的网络",!1)},complete:function(){NProgress.done(),$(".user-login-btn,.user-login-email,.user-login-password").prop("disabled",!1).removeClass("disabled")}})})});